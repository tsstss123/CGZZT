# 要结题了

---

## 研究过程

从七月开始我们开始理论学习，主要分为两部分，图像方面包括理论基础，传统图像处理流程（灰度，降噪，二值，分割，矫正），机器学习方面包括传统机器学习算法，机器学习在图像分类上的应用，深度学习等。此类验证码比较特殊，不同于绝大多数验证码图片，干扰比较特殊且强烈，主要集中在颜色部分，我们首先考虑了采用颜色预处理后分割识别的思路进行尝试。

第一次尝试：二值化-分割-BP神经网络。此类验证码文字在颜色上主要存在两种形态，实心与中空，在边界上干扰非常严重，在第一步去除颜色时就遇到了一些问题。首先是边界信息损失严重。由于在生成图片的过程中对字符边界进行了特别的模糊操作，导致无法合理的进行灰度化。其次是正弦干扰线，由于干扰线多为与字符相近的颜色，故灰度之后干扰线和字符成为整体。

第二次尝试：合理灰度-去除干扰线-BP神经网络。拟合正弦干扰线去除为背景色，同样遇到了不小的问题。例如干扰线穿插入字符，去除干扰线后没有一个合适的填充数值。不论如何填充均无法修复字符，填充反而容易破坏原有的字符特征。在拟合的过程中也容易出现拟合效果不好直接导致干扰增加的情况。

第三次尝试：放弃传统的处理-预测流程，尝试使用深度学习建立端到端（End-to-End）的识别系统。首先，近年来深度学习在图像识别分类定位领域有突破性进展，结构合理的深度神经网络以及可以在图像识别任务中达到人类的水平，在物体图像定位上也有接近人类的表现（ImageNet竞赛），利用深度学习来识别此类验证码在理论上是完全可行的。其次，考虑做端到端的识别，是因为深度神经网络拥有非常强大的“自动提取特征”的能力。各种颜色在传统意义上是干扰，但是我们灰度化之后人眼反而不易辨认，也就是说颜色在人眼识别中同样是一种“特征”的存在。干扰线同理，若在训练样本中都存在干扰线，那么在识别中若训练合理干扰线将不会成为阻碍。由于深度学习对硬件的和环境要求比较高，我们需要选择合理的深度学习库来进行训练。在TensorFlow、caffe、mxnet三大主流框架中我们选择了单机资源利用最小、支持多平台运行的mxnet。下一步我们花费几周实现制作了3000张带正确识别结果的验证码图片用于训练集。然而我们发现此类验证码中字符集约有500个汉字，训练集中平均每类汉字数量仅有20,而实际上一些汉字的出现频率很低，仅有几个。在已知的成功的深度学习图片分类案例中，使用的训练集尺寸一般来说都比我们大2-4个数量级，而我们没有更多的时间让训练集的数量级提升。三个字组合输出有成百上千万中可能，我们构造了一个以归一化后的原图150x40为输入，1x1500为输出的七层经典网络，采用CPU训练调参。效果不佳

第四次尝试：简单预处理-深度卷积神经网络。进一步学习深度学习理论，我们对整个流程作出调整。观察所有图片，每个字符的位置范围都是确定的。尝试均匀切分为40x40的正方形图片，效果很好，目标文字没有出现被裁切的情况，只是无法处理文字粘连。在深度学习的理论中，考虑到每个字符的颜色特征都不同，可以认为在样本量足够大的时候，神经网络能够自动按照颜色与形态特征将粘连视作干扰。训练部分，使用家用级GPU，使训练深层网络成为可能。网络设计部分，参考了今年ImageNet图像识别竞赛中成绩优异的多种网络结构（AlexNet，VGG，ZFNet，GoogleNet，ResNet）等等，考虑我们显卡的性能，设计出了一个合适的网络。在反复调参训练修改结构之后，对单个字符的识别正确率已经超过90%。完成GUI部分后进行总体测试，验证码的识别率超过80%，远超15%的项目要求。


## 改进

回顾整个过程，还有有很多地方值得改进。例如在初期尝试中的图像处理内容没有出现在最终的算法中，若在制作训练集时对背景噪点进行合适的降噪效果应该能够提升。在图像分割的时候还可以引进目标定位的一些算法使得字符尽可能的出现在图片正中央。训练集还可以迭代增长来完成数量级上的提升，例如使用现在80%成功率的版本来辅助制作更大量的样本，只需要人力纠错，大大降低了打标签的成本。
